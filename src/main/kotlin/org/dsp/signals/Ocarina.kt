package org.dsp.signals

import org.dsp.config.Constants

class Ocarina {
    companion object {
        //TODO: This should be replaced by equations

        fun getPercentages() : List<Double> {
            val total = dft.sum()
            return dft.map { (it/total) * 100.0}
        }

        val dft = listOf(
            4043.063235317732,
            5000.0,
            1434.2264604029135,
            1455.6703617168112,
            1236.8680013121252,
            734.5271615221177,
            772.5449921673763,
            305.40766763841475,
            454.12034095739165,
            213.351202643994,
            154.19124194798434,
            111.23548480385803,
            104.71545538460693,
            89.8152071244435,
            89.1834469091004,
            76.8138699455898,
            67.17885737975794,
            60.12065300984909,
            61.780565207140604,
            55.298242166972464,
            56.41371900189113,
            55.91882544602941,
            54.4449885653097,
            53.403531942645465,
            55.02557048597964,
            53.0166019087225,
            52.02678332755278,
            53.12152526935018,
            51.783041071222854,
            51.52622590083709,
            51.867605379958476,
            49.93336593438037,
            50.20518522679478,
            49.92895733865286,
            48.84769267322699,
            47.114085994950614,
            49.828347820508974,
            50.34392917328629,
            48.96971339895962,
            49.32595690207341,
            48.40506722770604,
            49.72566993671427,
            48.91481696758698,
            47.160303738289485,
            43.7403968056678,
            40.04883393520353,
            39.47240962361136,
            37.04207153917298,
            34.10679496061942,
            31.279421639162432,
            29.732010078807903,
            28.962251858536863,
            36.44614986901455
        )

        val underwaveformDFT = listOf(
            4836.682127697746,
            5000.0,
            701.3848239569741,
            391.6463187639092,
            349.9652258697153,
            312.15875434374385,
            351.7466825124228,
            69.83861606709895,
            275.8181967534909,
            168.48433919070868,
            51.379125300761224,
            54.85589553500745,
            54.34953440072371,
            62.66655988905891,
            26.72358434431746,
            53.1973230944286,
            12.87630645398641,
            60.58628733993024,
            25.98915497003214,
            34.950064861881074,
            33.81043281530521,
            43.77709166288938,
            37.342104035783194,
            18.768044186024653,
            39.09677263109629,
            11.437816503904674,
            33.11446036359413,
            21.53898908022944,
            36.97620322021093,
            17.354968786496077,
            40.66759592728878,
            19.919080797904424,
            26.07843108128632,
            10.886486170511489,
            30.064899423250477,
            16.088115421263936,
            27.448244656194248,
            7.814150381642737,
            32.23142183454866,
            37.822403399618075,
            35.32569376873393,
            34.52861896207764,
            14.750238432570406,
            30.381760643720153,
            23.687328735426856,
            27.770900473862344,
            15.387586105548516,
            35.81272935321594,
            6.284467102576932,
            31.157539096479162,
            12.545794252837325,
            27.275049883028696,
            14.770942945280416
        )

        val underwaveformDFT0 = listOf(
            84.22932536125647,
            87.07345566386178,
            12.214400074424617,
            6.820399674560785,
            6.094536315732006,
            5.43614829128726,
            6.125559832931183,
            1.216217927948801,
            4.803288705260279,
            2.9341027277154446,
            0.8947515977847663,
            0.955298477553781,
            0.9464803547985893,
            1.091318784821342,
            0.4653829673168794,
            0.9264149507797718,
            0.2242368998270966,
            1.055091480906281,
            0.4525931066048653,
            0.608644584640019,
            0.5887982445438912,
            0.7623645300002824,
            0.6503012080310164,
            0.3268396926658433,
            0.6808582196587695,
            0.19918604164882603,
            0.5766780992604242,
            0.3750948421443523,
            0.6439291583425959,
            0.3022314210357342,
            0.708213622186125,
            0.34688463974424233,
            0.4541478225078919,
            0.18958479418065532,
            0.5235709373937728,
            0.28016956096970325,
            0.47800270282439217,
            0.13608101536134348,
            0.5613002560187599,
            0.6586654731034679,
            0.6151860460334023,
            0.6013052344657689,
            0.2568708464379619,
            0.5290889776802055,
            0.41250751368790195,
            0.48362165423127423,
            0.26797005930706685,
            0.623667620307826,
            0.10944205352544609,
            0.5425989198224637,
            0.21848113192847254,
            0.47498656934390354,
            0.2572314091318612
        )

        /**
         * 2 4682.252417474843
         * 3 5000.0
         * 4 469.2704390481807
         * 5 505.4510210141876
         * 6 309.30198611515357
         * 7 277.0807526102476
         * 8 280.40133698328714
         * 9 79.96084800071215
         * 10 220.88385078673437
         * 11 18.91325877995051
         */

        val underwaveformDft = listOf(
            4686.151784159397,
            5000.0,
            500.0,
            500.0,
            500.0,
            500.0,
            500.0,
            500.0,
            500.0,
            500.0,
        ) /*+ (0 until 54 - 11).map { 100.0}*/

        val underwaveformDft0 = listOf(
            4686.151784159397,
            5000.0,
            477.5064332832903,
            516.167315641997,
            302.88051506127607,
            273.6126425051032,
            293.09037418255963,
            96.55845999434604,
            231.61520927462573,
            87.04069452658997,
            13.523325681766556,
            29.868130932042206,
            29.855252649918523,
            2.3117142781591857,
            7.610835549344019,
            11.64259906805113,
            14.243953454927702,
            10.584451048670699,
            7.062162503749964,
            12.366637954945674,
            15.016332340437513,
            7.448303051353789,
            6.343712939407038,
            10.734272626763822,
            13.923984700939755,
            14.722438178722795,
            7.050981457696961,
            11.92197642328876,
            2.35525479138945,
            8.552417181154574,
            2.1183557618294953,
            7.101364796359484,
            8.23413820351669,
            8.160813483194243,
            3.7705498418542356,
            4.940789102395166,
            1.5390419830990936,
            17.07622375177058,
            11.18044155083269,
            14.007308087614758,
            15.043388166674843,
            8.101480490305846,
            1.2290767801967106,
            10.002273899508678,
            13.326758927312008,
            9.26608611735928,
            5.990352962674566,
            12.667605285978748,
            2.8261709360550213,
            2.9096670860740335,
            4.230254997251348,
            1.9590297524659142,
            13.368654994788411
        )

        val underwaveformDft3 = listOf(
            /*0.0,
            4984.107826586728,*/
           // 5000.0,
            163.98729424825518,
            110.60697447302087,
            25.689345151596896,
            25.51071809382178,
            27.950045756415225,
            24.368441612618508,
            20.919363355840257,
            12.0093552593699,
            16.527397100099964,
            13.674436331659797,
            9.305782110282054,
            7.531736268571523,
            3.226807933664337,
            3.5606957279065825,
            5.030264952119969,
            4.626271181862122,
            3.4371829069774837,
            4.983225814780402,
            2.6054353237869767,
            3.336107571865094,
            4.7621613957542115,
            3.5220455184915465,
            2.773587977505126,
            2.5534924417471845,
            3.922844134123103,
            5.333405164145967,
            2.6185119140002233,
            3.084336656288455,
            3.6479515407808125,
            0.37105037442858924,
            3.048283195822257,
            2.6233415929748367,
            0.28258849929318514,
            0.7632255847978759,
            2.3549623850416834,
            1.6649065285178481,
            2.7274930204478878,
            1.5674388649159723,
            0.8045261416308418,
            1.316016206462264,
            1.9455337251404534,
            3.8195477052729196,
            4.052675478575261,
            0.9280541971185247,
            2.435616928315161,
            0.8619966042643176,
            2.6778336152907225,
            1.9771217247063013,
            1.8837376898511295,
            1.6846745378067742,
            1.0595733649002517,
            0.5980688798941082,
            1.422194328398502,
            1.3035714285714286
        )

        //TODO: What's interesting  here is the fundamental is not so loud but we'll se how much of a difference that makes
        val underwaveformDft2 = listOf(
            1671.2454769004694,
            119.94669956370288,
            84.73393551193121,
            42.774860033202174,
            34.321408717292556,
            29.971349921157604,
            22.221109171139766,
            22.116493130158467,
            13.834501243830768,
            16.381686200343186,
            10.500521013779748,
            8.853349815500954,
            7.40075903718275,
            7.164182872315244,
            6.499984860195452,
            6.158481518176552,
            5.656960006544402,
            5.217823535968935,
            4.964120976202762,
            4.733589321767905,
            4.548333406694189,
            4.388085886755641,
            4.2355241443244775,
            4.084052637702699,
            3.9322757436204965,
            4.019042148642756,
            3.8306713220979156,
            3.730306630775664,
            3.670276589653554,
            3.576101249462129,
            3.5519727496550866,
            3.4256983662462632,
            3.4937328174422673,
            3.39637204725974,
            3.356323170120514,
            3.286637688828452,
            3.165443543441957,
            3.1685639163591537,
            3.232748541293482,
            3.1490937548417017,
            3.124880540089819,
            3.02734169564887,
            3.1468835627670804,
            3.004805158623827,
            2.94512236016057,
            2.945199203787821,
            2.780312545811374,
            2.8089216891523248,
            2.7827536449513643,
            2.6070971062302633,
            2.629116210448867,
            2.5457012662942913,
            2.541142187934117
        )

        //TODO: This is terribly inefficient and has too many moving parts. É uma gambiarra
        fun getUnderwaveformFrequencyMagnitudes(frequency: Double) : List<Double> {
            val wavelength = Constants.SAMPLE_RATE / frequency
            val numHarmonics = (wavelength / 2).toInt()
            //println("frequency: $frequency, wavelength: $wavelength, numHarmonics: $numHarmonics")
            if (numHarmonics <= underwaveformDft.size) {
                return underwaveformDft.subList(0, numHarmonics)
            } else {
                val diff = numHarmonics - underwaveformDft.size
                val extension = underwaveformDft + (0 until diff).map { 1.0 }

                return extension
            }
        }


    }
}